angular.module("navbar.controllers",["ngCookies"]).controller("NavBar",["$scope","Users","$cookieStore","$rootScope","$timeout",function(a,f,d,g,e){a.isNav=!0;a.isSearch=!0;a.signupText="\u6ce8\u518c";a.loginText="\u767b\u9646";g.login=function(){a.loginOpen=!0};g.signup=function(){a.signupOpen=!0};a.opts={backdropFade:!0,dialogFade:!0};a.loginClose=function(){a.loginOpen=!1};a.signupClose=function(){a.signupOpen=!1};a.signupSubmit=function(){a.waitSign=!0;a.signupText="\u6ce8\u518c\u4e2d...";(new f(a.signup)).$signup(function(c){c.token?
(d.put("auth_tkt",c.token),e(function(){a.signupOpen=!1;location.reload()},10)):(a.waitSign=!1,a.signupText="\u6ce8\u518c")},function(c){c.data.errors.forEach(function(b){if(/username_exist/g.test(b.name))a.userExist=!0;else if(/username_none/g.test(b.name)||/username_invalid/g.test(b.name))a.signupUserF=!0;else if(/password_none/g.test(b.name)||/password_invalid/g.test(b.name))a.signupPsdF=!0;else if(/password_confirm_none/g.test(b.name)||/password_confirm_invalid/g.test(b.name)||/password_mismatch/g.test(b.name))a.signupPsddF=
!0});a.waitSign=!1;a.signupText="\u6ce8\u518c"})};a.rmUE=function(){a.userExist=!1};a.loginSubmit=function(){a.waitLogin=!0;a.loginText="\u767b\u5f55\u4e2d...";(new f(a.login)).$login(function(c){c.token?(d.put("auth_tkt",c.token),e(function(){a.loginOpen=!1;location.reload()},10)):(a.waitLogin=!1,a.loginText="\u767b\u9646")},function(c){c.data.errors.forEach(function(b){/username_none/g.test(b.name)||/username_invalid/g.test(b.name)?a.loginUserF=!0:/password_none/g.test(b.name)||/password_invalid/g.test(b.name)?
a.loginPsdF=!0:/username_not_exist/g.test(b.name)?a.userNExist=!0:/password_error/g.test(b.name)&&(a.passError=!0)});a.waitLogin=!1;a.loginText="\u767b\u9646"})};a.rmNUE=function(){a.userNExist=!1};a.rmPasError=function(){a.passError=!1};a.logout=function(){var a=d.get("auth_tkt");f.logout({token:a},function(){d.remove("auth_tkt");e(function(){location.reload()},10)},function(){d.remove("auth_tkt");e(function(){location.reload()},10)})}}]);
